<div class="container">
  <div class="row">
    <h3>Product report</h3>
  </div>
  <div class="row mt-3 mb-3 d-flex justify-content-around">
    <div class="col-4 mt-1">
      <br>
      <input type="text" name="search" id="search" placeholder="Search..." class="form-control"
        [(ngModel)]="searchedPhrase">
    </div>
    <div class="col-4">
      <h6>Sort by interval: </h6>
      <select name="insdate" id="dateSelect" class="form-control" [(ngModel)]="searchedPhrase">
        <option *ngFor='let date of dates' [value]="date">{{date|date:'yyyy MMMM'}}</option>
      </select>
    </div>
    <div class="col-4">
      <h6>Sort by product: </h6>
      <select name="product" id="productSelect" class="form-control" [(ngModel)]="searchedPhrase">
        <option *ngFor='let product of products$|async' [value]="product.name">{{product.name}}</option>
      </select>
    </div>
  </div>
  <div class="row text-center mt-5">
    <div class="col-6">
      <h5> Orders:
        {{orders$ |async |search:searchedPhrase | sum:'quantity'}}
      </h5>
    </div>
    <div class="col-6">
      <h5 colspan="3"> Total Income:
        {{orders$ |async |search:searchedPhrase |sum:'unitprice'}}
      </h5>
    </div>
  </div>
  <div class="text-center">
  </div>
  <div class="row">
    <div class="col">
      <table class="table table-striped">
        <thead>
          <tr>
            <th>user</th>
            <th>product</th>
            <th>quantity</th>
            <th (click)="setOrderBy('insdate')">insdate &#8645;</th>
            <th (click)="setOrderBy('status')">status &#8645;</th>
          </tr>
        </thead>
        <tbody>
          <tr
            *ngFor='let order of orders$| async | search:searchedPhrase| orderby:orderKey:orderDirection:changeCounter'>
            <td>{{order.user.firstname}} {{order.user.lastname}}</td>
            <td>
              <div *ngFor='let product of order.product'>
                {{product.name}}</div>
            </td>
            <td>
              <div *ngFor='let quantity of order.quantity; let i=index'>
                {{quantity[order.product[i].name]}}</div>
            </td>
            <td>{{order.insdate|date}}</td>
            <td>{{order.status}}</td>
          </tr>
          <tr class="text-center">
            <th colspan="2">
              Orders:
              {{orders$ |async |search:searchedPhrase | sum:'quantity'}}
            </th>
            <th colspan="3">
              Total income:
              {{orders$ |async |search:searchedPhrase |sum:'unitprice'}}
            </th>

          </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>
