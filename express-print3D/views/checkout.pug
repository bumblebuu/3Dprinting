extends layout

block content
  link(rel='stylesheet', href='/stylesheets/checkout.css')
  .container.checkout-container
    form#checkout-form(action='/pay',method='POST')
      h2 Checkout form
      .row
        .col-md-4.order-md-2.mb-4
          h4.d-flex.justify-content-between.align-items-center.mb-3
            span.text-muted Your cart
            span.badge.badge-secondary.badge-pill=basket.length
          ul.list-group.mb-3
            each item in basket
              li.list-group-item.d-flex.justify-content-between.lh-condensed
                div
                  a(href=`/products/product/${item.product.seo}`)
                    h6.my-0=item.product.name
                  small.text-muted Brief description
                span.text-muted $ #{item.quantity*item.price}
                input.d-none.form-control(type='text', value=item.product._id, name='id')
            li.list-group-item.d-flex.justify-content-between.bg-light
              .text-success
                h6.my-0 Promo code
                small EXAMPLECODE
              span.text-success -$5
            li.list-group-item.d-flex.justify-content-between
              span Total (USD)
              strong  $#{total}
          form.card.p-2
            .input-group
              input.form-control(type='text', placeholder='Promo code')
              .input-group-append
                button.btn.btn-secondary(type='submit') Redeem
        .col-md-8.order-md-1
          h4.mb-3 Billing address
          form.needs-validation(novalidate='')
            .row
              .col-md-6.mb-3
                label.text-secondary(for='firstName') First name
                input#firstName.form-control(type='text', placeholder='', value=user.firstname, required='')
                .invalid-feedback
                  | Valid first name is required.
              .col-md-6.mb-3
                label.text-secondary(for='lastName') Last name
                input#lastName.form-control(type='text', placeholder='', value=user.lastname, required='')
                .invalid-feedback
                  | Valid last name is required.
            .mb-3
              label.text-secondary(for='username') Username
              .input-group
                .input-group-prepend
                  span.input-group-text @
                input#username.form-control(type='text', value=user.username placeholder='Username', required='')
                .invalid-feedback(style='width: 100%;')
                  | Your username is required.
            .mb-3
              label(for='email').text-secondary
                | Email 
              input#email.form-control(type='email', placeholder='you@example.com',value=user.email required='')
              .invalid-feedback
                | Please enter a valid email address for shipping updates.
            .mb-3
              label.text-secondary(for='address') Address
              input#address.form-control(type='text', placeholder='1234 Main St', value=`${user.address[3]} ${user.address[4]}` required='')
              .invalid-feedback
                | Please enter your shipping address.
            .mb-3
              label.text-secondary(for='address2')
                | Address 2 
                span.text-muted (Optional)
              input#address2.form-control(type='text', placeholder='Apartment or suite')
            .row
              .col-md-4.mb-3
                label.text-secondary(for='city') City
                input#city.form-control(type='text', value=user.address[1], placeholder='', required='')
                .invalid-feedback
                  | Please provide a valid city.
              .col-md-5.mb-3
                label.text-secondary(for='country') Country
                input#country.form-control(type='text', value=user.address[0], placeholder='', required='')
                .invalid-feedback
                  | Please provide a valid country.
              .col-md-3.mb-3
                label.text-secondary(for='zip') Zip
                input#zip.form-control(type='text', placeholder='',value=user.address[2], required='')
                .invalid-feedback
                  | Zip code required.
            hr.mb-4
            .custom-control.custom-checkbox
              input#same-address.custom-control-input(type='checkbox')
              label.text-secondary.custom-control-label(for='same-address') Shipping address is the same as my billing address
            hr.mb-4
            h4.mb-3 Payment
            .d-block.my-3
              .custom-control.custom-radio
                input#credit.custom-control-input(name='paymentMethod', type='radio', checked='', required='')
                label.text-secondary.custom-control-label(for='credit') Credit card
              .custom-control.custom-radio
                input#paypal.custom-control-input(name='paymentMethod', type='radio', required='')
                label.text-secondary.custom-control-label(for='paypal') Paypal
            .row
              .col-md-6.mb-3
                label.text-secondary(for='cc-name') Name on card
                input#cc-name.form-control(type='text', name='card.name' placeholder='', required='')
                small.text-muted Full name as displayed on card
                .invalid-feedback
                  | Name on card is required
              .col-md-6.mb-3
                label.text-secondary(for='cc-number') Credit card number
                input#cc-number.form-control(type='number', name='card.number' placeholder='', required='')
                .invalid-feedback
                  | Credit card number is required
            .row
              .col-md-3.mb-3
                label.text-secondary(for='cc-exp-month') Expiration Month
                input#cc-exp-month.form-control(type='number', name='card.exp-month' placeholder='', required='')
                .invalid-feedback
                  | Expiration month required
              .col-md-3.mb-3
                label.text-secondary(for='cc-exp-year') Expiration Year
                input#cc-exp-year.form-control(type='number', name='card.exp-year' placeholder='', required='')
                .invalid-feedback
                  | Expiration year required
              .col-md-3.mb-3
                label.text-secondary(for='cc-cvc') CVC
                input#cc-cvc.form-control(type='number', placeholder='', name='card.cvc' required='')
                .invalid-feedback
                  | Security code required
            hr.mb-4
            button#checkbtn.btn.btn-primary.btn-lg.btn-block.my-3(type='submit') Continue to checkout
        .col-md-8.order-md-3
          button#subbtn.d-none.btn.btn-primary.btn-lg.btn-block.my-3(type='submit') Pay
      .payment-errors.d-none.alert.alert-danger


  script(src="https://js.stripe.com/v2/")
  script
    include ../public/js/checkout.js